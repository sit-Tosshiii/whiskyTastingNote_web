# Whisky Tasting Note | プロダクト要件整理

## 1. プロジェクト概要
- スマートフォン利用を主軸にした個人向けテイスティングノート PWA。
- ブラウザの IndexedDB にデータを保存し、オフラインでも利用できることが特徴。
- 将来的な収益化は広告表示やブランド協業を想定。

## 2. 想定ユーザーと利用シナリオ
- 自分用のウイスキーメモを継続的に残したい個人ユーザー。
- ノートを登録 → 一覧で検索・編集・削除 → 後で読み返す、のシンプルな導線。
- マルチデバイス利用やクラウド同期は、分析・共有機能の拡張フェーズで検討。

## 3. 現在実装済み / 優先機能
- **テイスティングノート管理（IndexedDB）**
  - 入力項目：銘柄名、蒸留所名、産地、香り、味わい、総合コメント、ABV、樽、スコア。
  - 香り／味わいサジェスト機能：`distilleries.json` 由来の語彙からランダム提示とカテゴリ別チェックリストを提供。
  - 一覧から直接編集・削除可能。編集ページはローカルデータを読み込み、バリデーションも共通化。
- **検索・閲覧**
  - IndexedDB 上のすべてのノートを最新順で表示。
  - 銘柄・蒸留所・産地・メモなどを横断してキーワード検索。
- **PWA 対応**
  - `manifest.json` と `sw.js` によりホーム画面追加とオフライン表示をサポート。
  - ブックマークレットで直近ノートを入力フォームへ自動反映 (`docs/bookmarklets.md`)。

## 4. 進行中 / 今後の機能検討
- 広告表示と動画視聴による収益化導線の確立。
- ユーザーが任意でデータをサーバーに送信して分析レポートを得られる機能（広告動画視聴でアンロックなど）。
- Word2Vec / PCA / k-NN を使った嗜好分析とレコメンド API の導入。
- データ共有・公開プロフィール・タグ付けなどコミュニティ的機能。

## 5. 非機能要件と運用方針
- **UX / UI**: スマホ向けレスポンシブを最優先。暗色基調で視認性を維持。
- **データ保全**: IndexedDB のバックアップ方法（`docs/data_seeding.md`）を案内し、ユーザー自身でエクスポートできるようにする。
- **PWA 品質**: キャッシュ戦略や更新通知を見直し、将来は Push 通知も検討。
- **収益計測**: 広告表示回数や動画視聴回数を計測可能にするため、イベントログ設計を進める。

## 6. 収益化のアイデア整理
- **アフィリエイト／バナー広告**
  - 強み: 初期導入が容易で、嗜好データと合わせて訴求しやすい。
  - 注意点: トラフィック増と広告品質のバランス、広告ポリシーへの準拠。
- **スポンサー / コラボ広告**
  - 強み: 単価が高く、分析レポートと連携できる。
  - 注意点: 営業・調整工数、UX への影響。
- **動画広告 + 機能アンロック**
  - 分析機能を利用する前に動画を視聴してもらい、視聴完了で分析 API への権限を付与する仕組みを検討。

## 7. 技術スタックとアーキテクチャ方針
- **フロントエンド**: Next.js (App Router) + TypeScript。フォームは共通バリデーションで管理し、IndexedDB 保存を行う。
- **ローカルデータ**: `lib/localNotes.ts` で IndexedDB をラップ。`notes` ストアに JSON を保存し、ソート／検索はクライアントで処理。
- **PWA**: `manifest.json` と `sw.js` によるキャッシュ制御。`PwaProvider` で Service Worker を登録。
- **分析／広告**: 今後、外部 API やサーバーとの連携が必要になった場合でも、Docker + Postgres 環境を流用できるよう構成資産（`database/`, `supabase/`, `services/analytics/`）を保持。

## 8. 今後のタスク例
- IndexedDB からのエクスポート/インポート UI の実装（現状は開発者ツール経由）。
- 動画広告視聴フローと分析 API 連携の設計。
- 広告表示の最適化（位置・種類の AB テスト）。
- 嗜好分析モデルをクライアント or サーバーレスで提供するための設計検討。
- PWA の push 通知やバッジ更新などリッチ化。

